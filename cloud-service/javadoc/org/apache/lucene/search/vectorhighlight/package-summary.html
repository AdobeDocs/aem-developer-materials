<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (11.0.14) on Mon Dec 05 15:20:33 UTC 2022 -->
<title>org.apache.lucene.search.vectorhighlight (The Adobe Experience Manager SDK 2022.11.9850.20221116T162329Z-220900)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="dc.created" content="2022-12-05">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="org.apache.lucene.search.vectorhighlight (The Adobe Experience Manager SDK 2022.11.9850.20221116T162329Z-220900)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<a id="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<main role="main">
<div class="header">
<h1 title="Package" class="title">Package&nbsp;org.apache.lucene.search.vectorhighlight</h1>
</div>
<div class="contentContainer">
<section role="region"><a id="package.description">
<!--   -->
</a>
<div class="block">This is an another highlighter implementation.

<h2>Features</h2>
<ul>
<li>fast for large docs</li>
<li>support N-gram fields</li>
<li>support phrase-unit highlighting with slops</li>
<li>support multi-term (includes wildcard, range, regexp, etc) queries</li>
<li>need Java 1.5</li>
<li>highlight fields need to be stored with Positions and Offsets</li>
<li>take into account query boost and/or IDF-weight to score fragments</li>
<li>support colored highlight tags</li>
<li>pluggable FragListBuilder / FieldFragList</li>
<li>pluggable FragmentsBuilder</li>
</ul>

<h2>Algorithm</h2>
<p>To explain the algorithm, let's use the following sample text
 (to be highlighted) and user query:</p>

<table border=1>
<tr>
<td><b>Sample Text</b></td>
<td>Lucene is a search engine library.</td>
</tr>
<tr>
<td><b>User Query</b></td>
<td>Lucene^2 OR "search library"~1</td>
</tr>
</table>

<p>The user query is a BooleanQuery that consists of TermQuery("Lucene") 
with boost of 2 and PhraseQuery("search library") with slop of 1.</p>
<p>For your convenience, here is the offsets and positions info of the 
sample text.</p>

<pre>
+--------+-----------------------------------+
|        |          1111111111222222222233333|
|  offset|01234567890123456789012345678901234|
+--------+-----------------------------------+
|document|Lucene is a search engine library. |
+--------*-----------------------------------+
|position|0      1  2 3      4      5        |
+--------*-----------------------------------+
</pre>

<h3>Step 1.</h3>
<p>In Step 1, Fast Vector Highlighter generates <a href="FieldQuery.QueryPhraseMap.html" title="class in org.apache.lucene.search.vectorhighlight"><code>FieldQuery.QueryPhraseMap</code></a> from the user query.
<code>QueryPhraseMap</code> consists of the following members:</p>
<pre class="prettyprint">
public class QueryPhraseMap {
  boolean terminal;
  int slop;   // valid if terminal == true and phraseHighlight == true
  float boost;  // valid if terminal == true
  Map&lt;String, QueryPhraseMap&gt; subMap;
} 
</pre>
<p><code>QueryPhraseMap</code> has subMap. The key of the subMap is a term 
text in the user query and the value is a subsequent <code>QueryPhraseMap</code>.
If the query is a term (not phrase), then the subsequent <code>QueryPhraseMap</code>
is marked as terminal. If the query is a phrase, then the subsequent <code>QueryPhraseMap</code>
is not a terminal and it has the next term text in the phrase.</p>

<p>From the sample user query, the following <code>QueryPhraseMap</code> 
will be generated:</p>
<pre>
   QueryPhraseMap
+--------+-+  +-------+-+
|"Lucene"|o+->|boost=2|*|  * : terminal
+--------+-+  +-------+-+

+--------+-+  +---------+-+  +-------+------+-+
|"search"|o+->|"library"|o+->|boost=1|slop=1|*|
+--------+-+  +---------+-+  +-------+------+-+
</pre>

<h3>Step 2.</h3>
<p>In Step 2, Fast Vector Highlighter generates <a href="FieldTermStack.html" title="class in org.apache.lucene.search.vectorhighlight"><code>FieldTermStack</code></a>. Fast Vector Highlighter uses term vector data
(must be stored <a href="../../document/FieldType.html#setStoreTermVectorOffsets(boolean)"><code>FieldType.setStoreTermVectorOffsets(boolean)</code></a> and <a href="../../document/FieldType.html#setStoreTermVectorPositions(boolean)"><code>FieldType.setStoreTermVectorPositions(boolean)</code></a>)
to generate it. <code>FieldTermStack</code> keeps the terms in the user query.
Therefore, in this sample case, Fast Vector Highlighter generates the following <code>FieldTermStack</code>:</p>
<pre>
   FieldTermStack
+------------------+
|"Lucene"(0,6,0)   |
+------------------+
|"search"(12,18,3) |
+------------------+
|"library"(26,33,5)|
+------------------+
where : "termText"(startOffset,endOffset,position)
</pre>
<h3>Step 3.</h3>
<p>In Step 3, Fast Vector Highlighter generates <a href="FieldPhraseList.html" title="class in org.apache.lucene.search.vectorhighlight"><code>FieldPhraseList</code></a>
by reference to <code>QueryPhraseMap</code> and <code>FieldTermStack</code>.</p>
<pre>
   FieldPhraseList
+----------------+-----------------+---+
|"Lucene"        |[(0,6)]          |w=2|
+----------------+-----------------+---+
|"search library"|[(12,18),(26,33)]|w=1|
+----------------+-----------------+---+
</pre>
<p>The type of each entry is <code>WeightedPhraseInfo</code> that consists of
an array of terms offsets and weight. 
</p>
<h3>Step 4.</h3>
<p>In Step 4, Fast Vector Highlighter creates <code>FieldFragList</code> by reference to
<code>FieldPhraseList</code>. In this sample case, the following
<code>FieldFragList</code> will be generated:</p>
<pre>
   FieldFragList
+---------------------------------+
|"Lucene"[(0,6)]                  |
|"search library"[(12,18),(26,33)]|
|totalBoost=3                     |
+---------------------------------+
</pre>

<p>
The calculation for each <code>FieldFragList.WeightedFragInfo.totalBoost</code> (weight)  
depends on the implementation of <code>FieldFragList.add( ... )</code>:
<pre class="prettyprint">
  public void add( int startOffset, int endOffset, List&lt;WeightedPhraseInfo&gt; phraseInfoList ) {
    float totalBoost = 0;
    List&lt;SubInfo&gt; subInfos = new ArrayList&lt;SubInfo&gt;();
    for( WeightedPhraseInfo phraseInfo : phraseInfoList ){
      subInfos.add( new SubInfo( phraseInfo.getText(), phraseInfo.getTermsOffsets(), phraseInfo.getSeqnum() ) );
      totalBoost += phraseInfo.getBoost();
    }
    getFragInfos().add( new WeightedFragInfo( startOffset, endOffset, subInfos, totalBoost ) );
  }
  
</pre>
The used implementation of <code>FieldFragList</code> is noted in <code>BaseFragListBuilder.createFieldFragList( ... )</code>:
<pre class="prettyprint">
  public FieldFragList createFieldFragList( FieldPhraseList fieldPhraseList, int fragCharSize ){
    return createFieldFragList( fieldPhraseList, new SimpleFieldFragList( fragCharSize ), fragCharSize );
  }
</pre>
<p>
Currently there are basically to approaches available:
</p>
<ul>
<li><code>SimpleFragListBuilder using SimpleFieldFragList</code>: <i>sum-of-boosts</i>-approach. The totalBoost is calculated by summarizing the query-boosts per term. Per default a term is boosted by 1.0</li>
<li><code>WeightedFragListBuilder using WeightedFieldFragList</code>: <i>sum-of-distinct-weights</i>-approach. The totalBoost is calculated by summarizing the IDF-weights of distinct terms.</li>
</ul> 
<p>Comparison of the two approaches:</p>
<table border="1">
<caption>
        query = das alte testament (The Old Testament)
</caption>
<tr><th>Terms in fragment</th><th>sum-of-distinct-weights</th><th>sum-of-boosts</th></tr>
<tr><td>das alte testament</td><td>5.339621</td><td>3.0</td></tr>
<tr><td>das alte testament</td><td>5.339621</td><td>3.0</td></tr>
<tr><td>das testament alte</td><td>5.339621</td><td>3.0</td></tr>
<tr><td>das alte testament</td><td>5.339621</td><td>3.0</td></tr>
<tr><td>das testament</td><td>2.9455688</td><td>2.0</td></tr>
<tr><td>das alte</td><td>2.4759595</td><td>2.0</td></tr>
<tr><td>das das das das</td><td>1.5015357</td><td>4.0</td></tr>
<tr><td>das das das</td><td>1.3003681</td><td>3.0</td></tr>
<tr><td>das das</td><td>1.061746</td><td>2.0</td></tr>
<tr><td>alte</td><td>1.0</td><td>1.0</td></tr>
<tr><td>alte</td><td>1.0</td><td>1.0</td></tr>
<tr><td>das</td><td>0.7507678</td><td>1.0</td></tr>
<tr><td>das</td><td>0.7507678</td><td>1.0</td></tr>
<tr><td>das</td><td>0.7507678</td><td>1.0</td></tr>
<tr><td>das</td><td>0.7507678</td><td>1.0</td></tr>
<tr><td>das</td><td>0.7507678</td><td>1.0</td></tr>
</table>

<h3>Step 5.</h3>
<p>In Step 5, by using <code>FieldFragList</code> and the field stored data,
Fast Vector Highlighter creates highlighted snippets!</p></div>
</section>
<ul class="blockList">
<li class="blockList">
<table class="typeSummary">
<caption><span>Interface Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Interface</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="BoundaryScanner.html" title="interface in org.apache.lucene.search.vectorhighlight">BoundaryScanner</a></th>
<td class="colLast">
<div class="block">Finds fragment boundaries: pluggable into <a href="BaseFragmentsBuilder.html" title="class in org.apache.lucene.search.vectorhighlight"><code>BaseFragmentsBuilder</code></a></div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="FragListBuilder.html" title="interface in org.apache.lucene.search.vectorhighlight">FragListBuilder</a></th>
<td class="colLast">
<div class="block">FragListBuilder is an interface for FieldFragList builder classes.</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="FragmentsBuilder.html" title="interface in org.apache.lucene.search.vectorhighlight">FragmentsBuilder</a></th>
<td class="colLast">
<div class="block"><a href="FragmentsBuilder.html" title="interface in org.apache.lucene.search.vectorhighlight"><code>FragmentsBuilder</code></a> is an interface for fragments (snippets) builder classes.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="BaseFragListBuilder.html" title="class in org.apache.lucene.search.vectorhighlight">BaseFragListBuilder</a></th>
<td class="colLast">
<div class="block">A abstract implementation of <a href="FragListBuilder.html" title="interface in org.apache.lucene.search.vectorhighlight"><code>FragListBuilder</code></a>.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="BaseFragmentsBuilder.html" title="class in org.apache.lucene.search.vectorhighlight">BaseFragmentsBuilder</a></th>
<td class="colLast">
<div class="block">Base FragmentsBuilder implementation that supports colored pre/post
 tags and multivalued fields.</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="BreakIteratorBoundaryScanner.html" title="class in org.apache.lucene.search.vectorhighlight">BreakIteratorBoundaryScanner</a></th>
<td class="colLast">
<div class="block">A <a href="BoundaryScanner.html" title="interface in org.apache.lucene.search.vectorhighlight"><code>BoundaryScanner</code></a> implementation that uses <code>BreakIterator</code> to find
 boundaries in the text.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="FastVectorHighlighter.html" title="class in org.apache.lucene.search.vectorhighlight">FastVectorHighlighter</a></th>
<td class="colLast">
<div class="block">Another highlighter implementation.</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="FieldFragList.html" title="class in org.apache.lucene.search.vectorhighlight">FieldFragList</a></th>
<td class="colLast">
<div class="block">FieldFragList has a list of "frag info" that is used by FragmentsBuilder class
 to create fragments (snippets).</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="FieldFragList.WeightedFragInfo.html" title="class in org.apache.lucene.search.vectorhighlight">FieldFragList.WeightedFragInfo</a></th>
<td class="colLast">
<div class="block">List of term offsets + weight for a frag info</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="FieldFragList.WeightedFragInfo.SubInfo.html" title="class in org.apache.lucene.search.vectorhighlight">FieldFragList.WeightedFragInfo.SubInfo</a></th>
<td class="colLast">
<div class="block">Represents the list of term offsets for some text</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="FieldPhraseList.html" title="class in org.apache.lucene.search.vectorhighlight">FieldPhraseList</a></th>
<td class="colLast">
<div class="block">FieldPhraseList has a list of WeightedPhraseInfo that is used by FragListBuilder
 to create a FieldFragList object.</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="FieldPhraseList.WeightedPhraseInfo.html" title="class in org.apache.lucene.search.vectorhighlight">FieldPhraseList.WeightedPhraseInfo</a></th>
<td class="colLast">
<div class="block">Represents the list of term offsets and boost for some text</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="FieldPhraseList.WeightedPhraseInfo.Toffs.html" title="class in org.apache.lucene.search.vectorhighlight">FieldPhraseList.WeightedPhraseInfo.Toffs</a></th>
<td class="colLast">
<div class="block">Term offsets (start + end)</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="FieldQuery.html" title="class in org.apache.lucene.search.vectorhighlight">FieldQuery</a></th>
<td class="colLast">
<div class="block">FieldQuery breaks down query object into terms/phrases and keeps
 them in a QueryPhraseMap structure.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="FieldQuery.QueryPhraseMap.html" title="class in org.apache.lucene.search.vectorhighlight">FieldQuery.QueryPhraseMap</a></th>
<td class="colLast">
<div class="block">Internal structure of a query for highlighting: represents
 a nested query structure</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="FieldTermStack.html" title="class in org.apache.lucene.search.vectorhighlight">FieldTermStack</a></th>
<td class="colLast">
<div class="block"><code>FieldTermStack</code> is a stack that keeps query terms in the specified field
 of the document to be highlighted.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="FieldTermStack.TermInfo.html" title="class in org.apache.lucene.search.vectorhighlight">FieldTermStack.TermInfo</a></th>
<td class="colLast">
<div class="block">Single term with its position/offsets in the document and IDF weight.</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="ScoreOrderFragmentsBuilder.html" title="class in org.apache.lucene.search.vectorhighlight">ScoreOrderFragmentsBuilder</a></th>
<td class="colLast">
<div class="block">An implementation of FragmentsBuilder that outputs score-order fragments.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="ScoreOrderFragmentsBuilder.ScoreComparator.html" title="class in org.apache.lucene.search.vectorhighlight">ScoreOrderFragmentsBuilder.ScoreComparator</a></th>
<td class="colLast">
<div class="block">Comparator for <a href="FieldFragList.WeightedFragInfo.html" title="class in org.apache.lucene.search.vectorhighlight"><code>FieldFragList.WeightedFragInfo</code></a> by boost, breaking ties
 by offset.</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="SimpleBoundaryScanner.html" title="class in org.apache.lucene.search.vectorhighlight">SimpleBoundaryScanner</a></th>
<td class="colLast">
<div class="block">Simple boundary scanner implementation that divides fragments
 based on a set of separator characters.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="SimpleFieldFragList.html" title="class in org.apache.lucene.search.vectorhighlight">SimpleFieldFragList</a></th>
<td class="colLast">
<div class="block">A simple implementation of <a href="FieldFragList.html" title="class in org.apache.lucene.search.vectorhighlight"><code>FieldFragList</code></a>.</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="SimpleFragListBuilder.html" title="class in org.apache.lucene.search.vectorhighlight">SimpleFragListBuilder</a></th>
<td class="colLast">
<div class="block">A simple implementation of <a href="FragListBuilder.html" title="interface in org.apache.lucene.search.vectorhighlight"><code>FragListBuilder</code></a>.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="SimpleFragmentsBuilder.html" title="class in org.apache.lucene.search.vectorhighlight">SimpleFragmentsBuilder</a></th>
<td class="colLast">
<div class="block">A simple implementation of FragmentsBuilder.</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="SingleFragListBuilder.html" title="class in org.apache.lucene.search.vectorhighlight">SingleFragListBuilder</a></th>
<td class="colLast">
<div class="block">An implementation class of <a href="FragListBuilder.html" title="interface in org.apache.lucene.search.vectorhighlight"><code>FragListBuilder</code></a> that generates one <a href="FieldFragList.WeightedFragInfo.html" title="class in org.apache.lucene.search.vectorhighlight"><code>FieldFragList.WeightedFragInfo</code></a> object.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="WeightedFieldFragList.html" title="class in org.apache.lucene.search.vectorhighlight">WeightedFieldFragList</a></th>
<td class="colLast">
<div class="block">A weighted implementation of <a href="FieldFragList.html" title="class in org.apache.lucene.search.vectorhighlight"><code>FieldFragList</code></a>.</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="WeightedFragListBuilder.html" title="class in org.apache.lucene.search.vectorhighlight">WeightedFragListBuilder</a></th>
<td class="colLast">
<div class="block">A weighted implementation of <a href="FragListBuilder.html" title="interface in org.apache.lucene.search.vectorhighlight"><code>FragListBuilder</code></a>.</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</main>
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
<p class="legalCopy"><small>Copyright &copy; 2010 - 2022 Adobe. All Rights Reserved</small></p>
</footer>
</body>
</html>
